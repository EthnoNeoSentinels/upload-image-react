  const handleFileChange = async (
    event: React.ChangeEvent<HTMLInputElement>,
  ) => {
    const files = event.target.files;
    if (!files || files.length === 0) return;

    //file info
    //define file random id
    const newUid = crypto.randomUUID();
    // receive the file
    const file = files[0];
    //create blob url for the file
    const tempUrl = URL.createObjectURL(file);

    //check for file format in local
    let isError = false;
    let errorMsg = "";

    if (file.size === 0) {
      errorMsg = "File is empty";
      isError = true;
    } else if (!file.type.startsWith("image/")) {
      errorMsg = "Only image files are allowed.";
      isError = true;
    } else if (file.size > imageSizeRequired) {
      errorMsg = "File is too big! Max " + imageSizeText + ".";
      isError = true;
    }

    if (!isError) {
      const isValidImage = await checkImageCorruption(tempUrl);
      if (!isValidImage) {
        errorMsg = "File is corrupted or unreadable.";
        isError = true;
      }
    }
    // Prepare to insert image in uploading / error status
    const newImageItem: ImageUrl = {
      uid: newUid,
      name: file.name,
      status: isError ? "error" : "uploading",
      url: tempUrl,
      progress: 0,
      errorMsg: isError ? errorMsg : "",
    };

    setImageUrlArray((prev) => [...prev, newImageItem]);
    event.target.value = "";

    //if any error occur before, it interrupt the action,
    if (isError) {
      return;
    }

    const uploadInterval = setInterval(() => {
      setImageUrlArray((prevArray) => {
        return prevArray.map((image) => {
          if (image.uid !== newUid || image.status !== "uploading") {
            return image;
          }
          const nextProgress = image.progress + 20;
          return {
            ...image,
            progress: nextProgress >= 90 ? 90 : nextProgress,
          };
        });
      });
    }, 200);

    setTimeout(() => {
      clearInterval(uploadInterval); 

      updateImageStatus(newUid, {
        status: "done",
        progress: 100,
      });
    }, 2000);
  };
